<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#ffffff" />
  <title>Bitcoin Saving PWA</title>

  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="appbar">
    <div class="container appbar__inner">
      <h1 class="brand">Bitcoin Saving</h1>
      <button id="installBtn" class="btn btn--ghost" hidden>ติดตั้งแอป</button>
    </div>
  </header>

  <nav class="tabs">
    <div class="container tabs__inner">
      <a href="#/portfolio" class="tab" data-route>พอร์ตโฟลิโอ</a>
      <a href="#/converter" class="tab" data-route>ตัวแปลงค่า</a>
    </div>
  </nav>

  <main class="container">
    <!-- Portfolio -->
    <section id="view-portfolio" class="view">
      <div class="card">
        <div class="card__header">
          <h2 class="heading">ภาพรวมพอร์ต</h2>
          <div class="row gap">
            <label class="field">
              <span>สกุลเงิน</span>
              <select id="fiatSelect">
                <option>THB</option>
                <option>USD</option>
                <option>EUR</option>
                <option>JPY</option>
                <option>CAD</option>
              </select>
            </label>
            <label class="field">
              <span>หน่วยบิตคอยน์</span>
              <select id="btcUnitSelect">
                <option>BTC</option>
                <option>Satoshi</option>
              </select>
            </label>
            <div class="muted" id="priceBadge">กำลังดึงราคา…</div>
          </div>
        </div>

        <div class="grid stats">
          <div class="stat">
            <div class="stat__label">ลงทุนรวม</div>
            <div class="stat__value" id="totalFiat">-</div>
          </div>
          <div class="stat">
            <div class="stat__label">ต้นทุนเฉลี่ย (ต่อ 1 BTC)</div>
            <div class="stat__value" id="avgCost">-</div>
          </div>
          <div class="stat">
            <div class="stat__label">บิตคอยน์รวม</div>
            <div class="stat__value" id="totalBTCOrSats">-</div>
          </div>
          <div class="stat">
            <div class="stat__label">มูลค่าปัจจุบัน</div>
            <div class="stat__value" id="currentValue">-</div>
          </div>
          <div class="stat">
            <div class="stat__label">กำไร/ขาดทุน</div>
            <div class="stat__value" id="pnl">-</div>
          </div>
          <div class="stat">
            <div class="stat__label">กำไร/ขาดทุน (%)</div>
            <div class="stat__value" id="pnlPct">-</div>
          </div>
        </div>
      </div>

      <!-- กราฟบิตคอยน์สะสม (คำนวณจากประวัติรายวัน + แสดงวันที่) -->
      <div class="card">
        <div class="card__header">
          <h3 class="heading">กราฟบิตคอยน์สะสม</h3>
        </div>
        <div class="chart" id="accChartWrap">
          <svg id="accChart" preserveAspectRatio="none">
            <g id="accGrid"></g>
            <path id="accArea" class="chart-area" d=""></path>
            <path id="accPath" class="chart-line" d=""></path>
            <g id="accXTicks"></g>
            <g id="accYTicks"></g>
            <line id="accHoverLine" class="chart-hoverline" x1="0" x2="0" y1="0" y2="0" visibility="hidden"></line>
            <circle id="accDot" class="chart-dot" r="4" cx="0" cy="0" visibility="hidden"></circle>
          </svg>
          <div id="accTooltip" class="tooltip" hidden></div>
          <p id="accEmpty" class="muted" style="margin-top:8px;">ยังไม่พบข้อมูลกราฟ</p>
        </div>
      </div>

      <div class="card">
        <div class="card__header row gap">
          <h3 class="heading">ประวัติรายการ</h3>
          <button id="openAddTx" class="btn btn--primary">เพิ่มรายการ</button>
        </div>
        <div id="txList" class="list"></div>
      </div>
    </section>

    <!-- Converter -->
    <section id="view-converter" class="view" hidden>
      <div class="card">
        <div class="card__header">
          <h2 class="heading">ตัวแปลงค่า (Fiat ↔︎ Sats)</h2>
          <div class="row gap">
            <label class="field">
              <span>สกุลเงิน</span>
              <select id="convCurrency">
                <option>THB</option>
                <option>USD</option>
                <option>EUR</option>
                <option>JPY</option>
                <option>CAD</option>
              </select>
            </label>
            <div class="muted" id="convBadge">กำลังดึงราคา…</div>
          </div>
        </div>

        <div class="grid grid
